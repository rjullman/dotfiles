#!/usr/bin/env bash

add_login_item () {
  local name=$1 target=$2
  osascript -e "tell application \"System Events\" to make login item at end with properties {name: \"$name\", path: \"$target\", hidden:true}" > /dev/null
}

while read -r app || [[ -n "$app" ]]; do
  if [ -h "$HOME/Applications/${app}.app" ]; then
    add_login_item "$app" "$HOME/Applications/${app}.app"
  elif [ -e "/Applications/${app}.app" ]; then
    add_login_item "$app" "/Applications/${app}.app"
  else 
    fail "cannot find ${app}.app"
  fi
done < "$DOTFILES_ROOT/osx/autostart_apps"
