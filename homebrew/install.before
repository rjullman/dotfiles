#!/usr/bin/env bash

run_cmd_with_args() {
  local cmd=$1 list=$2 args=$3

  $list > /tmp/dot-grep-tmp

  while read -r arg || [[ -n "$arg" ]]; do
    set -- $arg
    if ! cat /tmp/dot-grep-tmp | grep $1 &> /dev/null; then
      if ! $cmd $arg; then
        fail "$cmd $arg"
      fi
    fi
  done < <(echo "$args")
}

# Install Homebrew
if test ! $(which brew)
then
  ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
  success "homebrew installed"
fi

TAPS=$(cat << 'EOF'
  caskroom/cask
  homebrew/dupes
  homebrew/versions
  neovim/neovim
EOF)

BREWS=$(cat << 'EOF'
  coreutils
  findutils --with-default-names
  gawk
  git
  gnu-indent --with-default-names
  gnu-sed --with-default-names
  gnu-tar --with-default-names
  gnu-which --with-default-names
  gnutls
  grep --with-default-names
  gzip
  htop-osx
  less
  neovim
  node
  python
  reattach-to-user-namespace
  tmux
  unzip
  watch
  wget
  zsh
EOF)

CASKS=$(cat << EOF
  alfred
  dropbox
  flux
  gimp
  google-chrome
  hammerspoon
  iterm2
  java
  seil
  skype
  spotify
EOF)

# Setup taps
run_cmd_with_args 'brew tap' 'brew tap' "$TAPS"

# Install brews
run_cmd_with_args 'brew install' 'brew list' "$BREWS"

# Install brew casks
run_cmd_with_args 'brew cask install' 'brew cask list' "$CASKS"
